# OpenCode Centralized Deployment

This repo tracks the shared OpenCode configuration for the LCLS team.

## Deployed Location

`/sdf/group/lcls/ds/dm/apps/dev/opencode/`

## User Setup

Add this shell wrapper to your `~/.bashrc` or `~/.zshrc`:

```bash
# opencode wrapper
#   opencode         → runs deployed/team version (default)
#   opencode --local → runs personal dev version
opencode() {
    local bin_dir="/sdf/group/lcls/ds/dm/apps/dev/code/.opencode/bin"
    local config_dir="/sdf/group/lcls/ds/dm/apps/dev/opencode"

    if [[ "$1" == "--local" ]]; then
        shift
        bin_dir="$HOME/.opencode/bin"
        config_dir="$HOME/.config/opencode"
    fi

    OPENCODE_CONFIG_DIR="$config_dir" PATH="$bin_dir:$PATH" command opencode "$@"
}
```

Then reload your shell: `source ~/.bashrc` (or `~/.zshrc`)

## Syncing from Deployed to Repo

To sync the latest deployed configs into this repo:

```bash
rsync -av --exclude='node_modules' --exclude='package.json' --exclude='bun.lock' \
  /sdf/group/lcls/ds/dm/apps/dev/opencode/ \
  /sdf/data/lcls/ds/prj/prjdat21/results/cwang31/deploy-opencode/opencode/
```

### What to exclude

| Exclude | Reason |
|---------|--------|
| `node_modules/` | NPM dependencies (6MB) - reinstalled by opencode automatically |
| `package.json` | Auto-generated by opencode for plugin dependencies |
| `bun.lock` | Lock file - auto-generated |

### What gets synced

| Include | Purpose |
|---------|---------|
| `opencode.json` | Main config (provider, models, theme) |
| `agents/*.md` | Agent definitions (elog-copilot, daq-logs, etc.) |
| `skills/*/SKILL.md` | Skill definitions (lcls-catalog, index-code) |
| `agents/index-code`, `agents/lcls-catalog` | Symlinks to skills for @invocation |

## Syncing from Repo to Deployed

To deploy changes back to the shared location:

```bash
rsync -av --exclude='node_modules' --exclude='package.json' --exclude='bun.lock' \
  /sdf/data/lcls/ds/prj/prjdat21/results/cwang31/deploy-opencode/opencode/ \
  /sdf/group/lcls/ds/dm/apps/dev/opencode/
```

## Related Documentation

- `CLAUDE.md` - Detailed deployment structure and source mappings
- `DEPLOY.md` - User setup instructions
- `docs/` - Additional documentation
